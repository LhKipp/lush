#!/bin/fish
function unescape
    set s "$argv"
    printf '%b\n' "$s"
end

function run_yaml
    cargo test $argv[1] 2>/dev/null | sed -n -e '/left:/p' | xargs -0 unescape | sed -n '/- /p'
end

function run_json
    cargo test | sed -n -e '/left:/p' | xargs -0 unescape | grep -o "\"\[.*]\"" | sed -e 's/^"//' -e 's/"$//'| jq
end

switch $argv[1]
    case "lex"
        run_yaml $argv
    case "*"
        run_yaml $argv
end
